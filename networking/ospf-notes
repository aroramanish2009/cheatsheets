## OSPF Concepts 
#OSPF Messages
  - Hello : Discover neighbors, bring 2-Way state, and maintain hello as keepalive status
  - Database Description (DD or DBD) : used to describe routers LSAs and its version numbers.
  - Link-State Request (LSR) : Neighbor requesting LSAs after looking into DD.
  - Link-State Update (LSU) : A packet that contains fully detailed LSAs sent as detailed info for LSR or Topology change.
  - Link-State Acknowledgment (LSAck): Sent to confirm receipt of an LSU message
#OSPF Neighbor States: 
  - init : Hello with self RID sent  : If struck here then --> check auth, primary subnet and mask, ospf area and type, hello and dead timers, unique RID and some times MTU. Use "debug ip ospf hello" or "show ip ospf interface f0/0" if issue persists. 
  - 2-way: Hello from neighbor with his and self RID in it.
  <-- DR Election happens here -->
  - Exstart/Exchange: master/slave selection then DD exchange  --> if stuck here check MTU mismatch
  - Loading: LSR/LSU/LSAck is done here. Routers use Link-State Request (LSR) packets to request one or more LSAs from a neighbor. The neighboring router replies with Link-State Update (LSU) packets, which hold one or more full LSAs.
  - Full: LSDB synced and algorithum ran on it.
#OSPF Timers
  - Default Hello timers : 10 hello and 30 dead.
#OSPF DBD Master/Slave:
  - Intially both send empty DD packets, lower RID router becomes slave.
  - Master send DD with sequence number and slave responds with its DD using same sequence number and M flag set ( remove M flag if doesnt have more DD) 
#OSPF DR-BDR
  - multicast/broadcast Networks only
  - All routers are in FULL STATE with DR-BDR only.
  - Non DR-BDR routers send LSU to 224.0.0.6 (DR-BDR multicast add) then DR sends that LSU to all OSPF routers 224.0.0.5. 
  - All routers (minus the original router of LSU) will send a LSAck back to DR (including BDR will send LSAck).
  - You can use "show ip ospf neighbor" to view neighborship state. All routers that are not DR/BDR are in 2WAY/DROTHER stable state.
  - DR-BDR Election:
    - High priority (0-255) wins, 0 means do not consider.
    - no preemption is allowed.
    - if BDR exists, then it becomes DR and election is held for new BDR.
    - If default priority then Higher RID becomes DR
    - If no RID is mentioned, highest Loopback is RID or highest active link IP is RID
  - DR on WAN and OSPF Network Types:
    - Broadcast Network : Requires DR/BDR, discovers Neighbors. Next hop does not change. 
    - NBMA : Requires DR/BDR, Manual Neighbors. 
    - P2P : No DR/BDR, discovers neighbors and Next Hop does change
    - p2m : No DR/BDR, discovers neighbors and every inferface must uniquely advertise itself. 
    - Anything Point != DR/BDR 
#OSPF Steady State
  - Hello every Hello Interval 
  - Neighbor Dead if Hello not recieved before dead interval 
  - Originating Router sending LSAs with incremented sequence number every 30 minutes 
  - LSAs MAXAge is 60 minutes
#OSPF LSA Types
  - LSA type 1 aka Router LSA 
    - Router LSA, generated by every router in every area
    - Allows routers to advertise their directly connected interfaces
    - view using "show ip ospf database router" for detailed LSA1 fields. 
  - LSA type 2 aka Network LSA 
    - Originated by DRs on all non-point-2-point links. 
    - The DR collects all the Type 1 LSAs and sends out a single Type 2 representing all of the routers on the link.
    - view using "show ip ospf database network" for detailed LSA2 fields. Attached router field can provide info regarding routers in broadcast field. 
  - LSA type 3 aka summary LSA 
    - Originated by ABRs 
    - ABRs send single LSA representing both LSA1 and LSA2 in an Area. Reduces number LSA on routers in other area's
    - "show ip ospf database summary" Provides information about all the links not in Area for routers in single area
  - LSA type 4 aka ASBR Summary LSA
    - Generated by ABRs connected to an area where external routes (Type 5) are originated
    - Type 4 LSAs are sent to other areas to build the Shortest Path Tree to an ASBR
    - "show ip ospf database asbr-summary" Shows links to ASBR as advertised by ABR
  - LSA type 5 aka AS External LSA
    - Generated by Routers with the redistribute command that are not in a NSSA area
    - This represents any external routes redistributed into OSPF.
    - "show ip ospf database external" shows links reditributed into OSPF
  - LSA type 6 aka OSPF Group Membership LSA
    - Used for MOSPF, not supported by Cisco and scheduled to be depricated. 
  - LSA type 7 aka OSPF NSSA External LSA
    - Generated by Routers with the redistribute command that are in a NSSA area
    - Type 5 LSAs are not allowed in Stub Areas and Type 7 allows external information to pass through NSSA areas.
  - LSA type 8 aka OSPF External Attributes LSA in IPv4 
    - Used to carry External BGP Attribute while the route information is carried in LSA5.
  - LSA 9,10 and 11 aka Opaque LSAs
    - Generally used for extending ospfv2 capabilities. 
    - LSA Type 9 in OSPFv2 (IPv4) is defined as a Link Scope Opaque LSA for carrying OSPF information.
    - LSA Type 10 packets are used to flood OSPF information even if inpath routers do not understand that information. Use for MPLS TE.
    - LSA Type 11 packets are used like LSA10 but are flooded into Special AREAs like Stub.

#OSPF E1 vs E2 routes
  - E1 preferred over E2 routes.
  - E1 routes have metric that include cost to reach the advertising ASBR.
  - E2 routes only use metrics that were added when route was redistributed into ospf. 
  - If multiple paths to E2 routes available, cost to forwarding router or ASBR is taken into consideration. 
  - Example 192.168.1.0/24 was advertised as E1 route by ASBR 7.7.7.7 and then ABR 1.1.1.1 sent LSA4 into Area 1 where R1 lives
    - show ip ospf database external 192.168.1.0 --> Cost as injected by ASBR 
    - show ip ospf database asbr-summary --> Look for cost to reach 7.7.7.7 as advertised by ABR 
    - show ip ospf database border-routers --> Look for cost to reach 1.1.1.1 
    - add all 3 for E1 cost 192.168.1.0/24 
NOTE: If you have multiple E2 routes for a subnet, cost comparison to reach ASBR (Like E1 cost) is used for tie-breaker to select route. If tie-breaker results in multiple routes than load balacing is performed on multiple routes.

#OSPF AREAs 
  - Stubby Areas: ABRs will stop advertising type 4 and 5 LSAs into this area. In addition, every internal router in a stubby area will ignore any received type 5 LSAs, and will not originate any such LSAs itself. ABRs in a stubby area will automatically inject a default route into the area as a type 3 LSA.
  - Anything that says Not-so-stubby means allows Type 7 Creation or ASBR.
  - Anything that says Totally means Stops Type 3 as well. 
  - Configuration: Neighborship wont come up if both sides not configured same.

#OSPF Path Selection in Order Below:
  - Intra-area routes
  - Inter-area routes
  - E1/N1 routes (the E1 and N1 routes are considered equivalent) - N means you got yourself NSSA somewhere
  - E2/N2 routes (the E2 and N2 routes are considered equivalent)
NOTE: ABR ignores all Type3 LSAs in SPF calculations if they were recieved from non-backbone areas.

#OSPF Tips and Tricks
  - "ip ospf multiarea 1" --> run interface in multiple areas 
  - "no capability transit" --> This is to fix the loop senario in case of double virtual links on the same router.
  - If FA (forwarding Address) is set, either it is NSSA or FA was manipulated. 
  - "area 2 nssa translate type7 suppress-fa" --> If you need to suppress-fa from ABR connected to area with ASBR
  - "no compatible rfc1583" under "router ospf 1" is used to enable RFC2328 that makes summary route take additive metrics.
  - "ignore lsa mospf" under "router ospf 1" - This is done to ignore LSA type6 
  - "ip ospf name-lookup" - router ospf commands use DNS names when displaying DB information instead of RID
